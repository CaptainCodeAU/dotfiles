# ~/.zsh_mac_welcome
# ==============================================================================
#  macOS Environment Health Check & Onboarding Script
# ==============================================================================
# This script follows the same pattern as WSL/Linux welcome scripts:
# - show_welcome(): Environment overview (informational only)
# - show_onboarding_summary(): Available helper functions
# - uv Python check: Offer to install default Python via uv if missing

# --- Function to show the macOS environment overview ---
show_welcome() {
    echo
    echo "${info}üõ°Ô∏è  macOS Environment Overview:${done}"
    echo "    macOS: $(sw_vers -productVersion 2>/dev/null || echo 'Unknown')"

    # --- uv (the preferred Python tool) ---
    if command -v uv &>/dev/null; then
        local uv_version=$(uv --version 2>/dev/null | awk '{print $2}')
        local uv_python_path=$(get_uv_python_path "${PYTHON_DEFAULT_VERSION}" 2>/dev/null)
        if [[ -n "$uv_python_path" ]]; then
            local uv_python_version=$("$uv_python_path" --version 2>/dev/null)
            echo "    uv: ${ok}${uv_version}${done} (Python ${PYTHON_DEFAULT_VERSION}: $uv_python_version)"
        else
            echo "    uv: ${ok}${uv_version}${done} (Python ${PYTHON_DEFAULT_VERSION}: ${warn}not installed${done})"
        fi
    else
        echo "    uv: ${err}Not Found${done}"
    fi

    # --- System Python (informational only) ---
    if command -v python3 &>/dev/null; then
        echo "    System python3: $(command which python3) ($(command python3 --version 2>/dev/null))"
    else
        echo "    System python3: ${err}Not Found${done}"
    fi

    # --- Node.js ---
    if command -v nvm &>/dev/null; then
        local active_node=$(nvm current)
        if [[ "$active_node" == "none" ]]; then
            echo "    Active Node: ${warn}None (default is $(nvm version default))${done}"
        else
            echo "    Active Node: ${ok}${active_node}${done} (npm: $(npm -v 2>/dev/null || echo 'N/A'), pnpm: $(pnpm -v 2>/dev/null || echo 'N/A'))"
        fi
    else
        echo "    Active Node: ${err}nvm not found${done}"
    fi

    # --- Docker ---
    if command -v docker &>/dev/null && docker ps &>/dev/null; then
        echo "    Docker: ${ok}Running${done}"
    else
        echo "    Docker: ${warn}Not Running${done}"
    fi
}

# --- Function to display onboarding summary ---
show_onboarding_summary() {
    echo "${info}üöÄ  RECOMMENDED WORKFLOW: Use 'uv' for all Python project work!${done}"
    echo "------------------------------------------------------------------------------------------------"
    echo "${ok}Custom Python Helper Functions (.zsh_python_functions):${done}"
    echo "  - ${info}python_new_project, python_setup, python_delete${done}"
    echo "  - ${info}pipx_install_current_project, pipx_reinstall_current_project, etc.${done}"
    echo
    echo "${ok}Custom Node.js Helper Functions (.zsh_node_functions):${done}"
    echo "  - ${info}node_new_project, node_setup, node_clean${done}"
    echo
    echo "${ok}Custom Docker Helper Functions (.zsh_docker_functions):${done}"
    echo "  - ${info}docker_clean, docker_stats, docker_logs, docker_shell, docker_ip${done}"
    echo "------------------------------------------------------------------------------------------------"
    echo
}

# --- Main Execution ---
show_welcome
show_onboarding_summary

# --- Check if uv has installed a base Python interpreter and prompt if not ---
# This is the same pattern as WSL/Linux welcome scripts.
if command -v get_uv_python_path &>/dev/null && ! get_uv_python_path "${PYTHON_DEFAULT_VERSION}" &>/dev/null; then
    echo
    echo "${warn}‚ö†Ô∏è  Default Python (${PYTHON_DEFAULT_VERSION}) not found in 'uv' cache.${done}"
    if [[ -t 1 ]]; then
        read "REPLY?    üëâ Would you like to run 'uv python install python@${PYTHON_DEFAULT_VERSION}' now? [y/N] "
        case "$REPLY" in
            [yY][eE][sS]|[yY])
                uv python install "python@${PYTHON_DEFAULT_VERSION}"
                ;;
            *)
                echo "${warn}    Skipping 'uv' Python installation.${done}"
                ;;
        esac
    fi
fi
